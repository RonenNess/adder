<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>Bot Wars</title>

    <!-- include AdderScript -->
    <script src="libs/adder.min.js"></script>

    <!-- jquery and bootstrap css -->
    <script src="libs/jquery.min.js" type="text/javascript"></script>
    <script src="libs/bootstrap.min.js" type="text/javascript"></script>
    <link href="libs/bootstrap.min.css" rel="stylesheet">

    <!-- include default font -->
    <link href="https://fonts.googleapis.com/css?family=VT323" rel="stylesheet">

    <!-- favicon -->
    <link rel="icon" href="./imgs/icon.png">

    <!-- some styling -->
    <link href="css/main.css" rel="stylesheet">

    <!-- code mirror -->
    <script src="libs/codemirror.js" type="text/javascript"></script>
    <script src="libs/python.js" type="text/javascript"></script>
    <script src="libs/matchbrackets.js" type="text/javascript"></script>
    <link href="libs/codemirror.css" rel="stylesheet">

</head>
<body>

    <!-- main content + background -->
    <div class="container container-fluid">

        <!-- shows current round -->
        <p id="rounds-show" style="text-align:center; color:white; font-size:4em; left: 0px; position:fixed; width:100%">Round: 0/25</p>

        <!-- player 1 gui -->
        <div style="position:fixed; left:0px;">
            <img class="gui-image" src="imgs/bot_status_back.png" style="" />
            <img class="gui-image" id="p1-action" src="imgs/reload_icon.png" style="" />
            <img id="p1-hp" class="gui-image" src="imgs/hp10.png" style="" />
            <img id="p1-sh" class="gui-image" src="imgs/sh7.png" style="" />
            <img id="p1-am" class="gui-image" src="imgs/am5.png" style="" />
            <div id="console" style="position:fixed; top:160px; left:10px; color:white; font-size: 1.6em;">
            </div>
        </div>

        <!-- player 2 gui -->
        <div class="flip-x" style="position:fixed; right:0px;">
            <img class="gui-image" src="imgs/bot_status_back.png" style="" />
            <img class="gui-image" id="p2-action" src="imgs/reload_icon.png" style="" />
            <img id="p2-hp" class="gui-image" src="imgs/hp10.png" style="" />
            <img id="p2-sh" class="gui-image" src="imgs/sh7.png" style="" />
            <img id="p2-am" class="gui-image" src="imgs/am5.png" style="" />
        </div>

        <!-- player 1 -->
        <div id="p1-graphics" class="player-container" style="right: calc(50% + 200px);">
            <img class="player-shadow-img" src="imgs/shadow.png" style="" />
            <img id="p1-img" class="player-img" src="imgs/player2.png" style="" />
        </div>
        <div id="p1-text" class="player-text-box" style="right: 50%;">
        </div>

        <!-- player 2 -->
        <div id="p2-graphics" class="player-container" style="left: calc(50% + 200px);">
            <img class="player-shadow-img" src="imgs/shadow.png" style="" />
            <img id="p2-img" class="player-img" src="imgs/player1.png" style="" />
        </div>
        <div id="p2-text" class="player-text-box" style="left: 50%;">
        </div>

    </div>

    <!-- main game javascript -->
    <script src="js/bot_wars.js" type="text/javascript"></script>
    <script src="js/main.js" type="text/javascript"></script>

    <!-- instructions modal -->
    <div id="instructions" class="modal fade" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">Welcome to Bot Wars!</h4>
          </div>
          <div class="modal-body">
            <p>
                The goal of the game is to program an AI (using <a href="http://www.adderscript.com" target="_blank">AdderScript</a>) to defeat the house AI. <br /><br />
                Every fight have 25 rounds, and in every round your bot can do one of the following actions:
            </p>
            <ui>
                <li>Load weapon.</li>
                <li>Shoot (must load weapon first).</li>
                <li>Heal (hit while healing double the damage).</li>
                <li>Use shield (up to 7 times per game).</li>
            </ui>
            <br />
            <p>
                The fight is over when one of the bots is left with 0 HP (red bar), or when 25 rounds pass (in which case the bot with more HP wins).
            </p>
          </div>
          <div class="modal-footer">
            <button type="button" data-dismiss="modal" class="btn btn-lg btn-primary">Got It!</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <!-- show instructions when page loads -->
    <script>
        function show_instructions() {
            $("#instructions").modal();
        }
        show_instructions();
    </script>

    <!-- instructions modal -->
    <div id="credits" class="modal fade" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">Bot Wars Credits</h4>
          </div>
          <div class="modal-body">
            <p>
                Bot Wars is a mini-game made by <a href="https://github.com/RonenNess" target="_blank">Ronen Ness</a> to demonstrate <a href="http://www.adderscript.com" target="_blank">AdderScript</a> abilities. <br /><br />
                All graphics and resources are the courtesy of some very talented artists that published their work under common creative and/or public license. Lets show them respect!
            </p>
            <ui>
                <li>Bot sprites by <a href="http://opengameart.org/users/redshrike" target="_blank">Stephen Challener</a>.</li>
                <li>City background by <a href="http://opengameart.org/users/tokyogeisha" target="_blank">"TokyoGeisha"</a>.</li>
                <li>UI by <a href="http://opengameart.org/users/buch" target="_blank">Michele Bucelli</a>.</li>
                <li>Explosions by <a href="http://opengameart.org/users/helpcomputer" target="_blank">"helpcomputer"</a>.</li>
                <li>Action Icons by <a href="http://oceansdream.deviantart.com/" target="_blank">"OceansDream"</a>.</li>
                <li>Skull by <a href="http://opengameart.org/users/cron" target="_blank">"cron"</a>.</li>
                <li>Cursor by <a href="http://www.lostgarden.com/" target="_blank">Daniel Cook</a>.</li>
            </ui>
              <br />
              <p>
                  Most graphics are heavily modified by myself, feel free to use the modified versions for any purpose or seek out the originals from the credit links.
              </p>
          </div>
          <div class="modal-footer">
            <button type="button" data-dismiss="modal" class="btn btn-lg btn-primary">Thanks! <3</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <!-- show instructions when page loads -->
    <script>
        function show_credits() {
            $("#credits").modal();
        }
    </script>


    <!-- generic message box -->
    <div id="msg-box" class="modal fade" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 id="msg-box-title" class="modal-title">Title</h4>
          </div>
          <div class="modal-body">
            <p id="msg-box-text">

            </p>
          </div>
          <div class="modal-footer">
            <button type="button" data-dismiss="modal" class="btn btn-lg btn-primary">Close</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <!-- show message box -->
    <script>
        function show_msg_box(title, text) {
            $("#msg-box-title").text(title);
            $("#msg-box-text").text(text);
            $("#msg-box").modal();
        }
    </script>


    <!-- before match menu and code -->
    <div id="play-menu" class="container-fluid" style="position:fixed; top:5.8em; width:100%;">
        <div class="row">
            <h1 style="color: white; position: relative; text-align: center;">Write Your Code:</h1>
            <div class="col-md-10 col-sm-12 col-xs-12 col-md-offset-1">
                <!-- code box -->
                <div style="border: 1px solid black; padding: 0px; height:100%;">
                    <textarea id="code" cols="100" rows="36"># In this code-box you write your bot's AI to fight against the enemy AI.
# This code executes once every round, and should perform one of the 4 possible actions: fire, reload, heal or shield.

# The code is written in AdderScript (see www.adderscript.com for more info).

# The default code below is a placeholder that do random actions and will probably lose. Fix it to win the fight!
# To see the available commands you can use click on 'Show API' button.
# To see your enemy AI, click on 'Show Enemy Code'.

# Tip: you can use print() to output debug messages to console (will pop at top-left corner).

# AI placeholder: do random action.

# first create a list with available actions
possible_actions = list()

# if got ammo - add "fire" to possible actions
if Self.get_ammo():
    possible_actions.append("fire")

# if got shields left - add "shield" to possible actions
if Self.get_shields_left():
    possible_actions.append("shield")

# if injured - add "heal" to possible actions
if Self.get_hp() < Self.get_max_hp():
    possible_actions.append("heal")

# if ammo is not full - add "reload" to possible actions
if Self.get_ammo() < Self.get_max_ammo():
    possible_actions.append("reload")

# Now select a random action to perform
curr = Random.select(possible_actions)
print("Selected action", "'" + curr + "'", "from options:", possible_actions)

# acts on it
if curr is "fire":
    Self.fire()
elif curr is "reload":
    Self.reload()
elif curr is "heal":
    Self.heal()
elif curr is "shield":
    Self.shield()

                    </textarea>
                </div>
                <button type="button" onclick="start_game();" class="btn menu btn-lg btn-danger">Go!</button>
                <button type="button" onclick="$('#api-modal').modal();" class="btn menu btn-lg btn-primary">Show API</button>
                <button type="button" onclick="show_enemy_code();" style="width: 300px;" class="btn menu btn-lg btn-primary">Show Enemy Code</button>
            </div>
        </div>

        <script>
        // show the new game menu
        function open_new_game_menu() {
            // show play menu
            $("#play-menu").show();
            $("#main-menu").hide();
        }

        // show enemy code
        function show_enemy_code() {
            $("#enemy-code-modal").modal();
        }

        // hide all menues
        function hide_all_menus() {
            $("#play-menu").hide();
            $("#main-menu").hide();
        }
        </script>
    </div>

    <!-- enemy code modal -->
    <div id="enemy-code-modal" class="modal fade" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">Enemy Code</h4>
          </div>
          <div class="modal-body">
            <p>
                The following code is your enemy AI:
            </p>
              <textarea id="enemy-code" rows="18" style="width:100%; resize:none;" readonly>
# ENEMY AI

# Special case - if last round and got ammo - always shoot!
if Self.get_ammo() and Match.get_rounds_left() == 0:
    Self.fire()

# If we don't have ammo but enemy does, sometimes use shield (randomly)
if Self.get_shields_left() and not Self.get_ammo() and Enemy.get_ammo() and Random.boolean():
    Self.shield()

# If enemy got no ammo and we are injured, heal
if not Enemy.get_ammo() and Self.get_hp() < 5:
    Self.heal()

# If got no ammo, reload!
if Self.get_ammo() == 0:
    Self.reload()

# if got here we just shoot
Self.fire()

            </textarea>
          </div>
          <div class="modal-footer">
            <button type="button" data-dismiss="modal" class="btn btn-lg btn-primary">Close</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->


    <!-- show api -->
    <div id="api-modal" class="modal fade" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document" style="width: 80%">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">Game API</h4>
          </div>
          <div class="modal-body">
            <p>
                As mentioned before, the code itself is written in <a href="http://www.adderscript.com" target="_blank">AdderScript</a>. If you are not familiar with the language (very similar to Python), check out the official site.
            </p>
            <p>
                The AI code can access 3 main API modules: 'Self', 'Enemy', and 'Match'.
            </p>

              <hr />
              <h1>Match</h1>
              <p>This module provide general data about the match itself:</p>
              <h2>Match.get_round_number()</h2>
              <p>Get current round number.</p>
              <h2>Match.get_rounds_left()</h2>
              <p>Get how many rounds left until end of fight.</p>

              <hr />
              <h1>Self</h1>
              <p>Provide data about your own bot and an API to choose the action for current round. <br />
              Note that once you call an action (like fire, reload etc) the code will exit and next lines of code will not execute.</p>
              <h2>Self.fire()</h2>
              <p>Fire your weapon (you must have loaded ammo for it to work).</p>
              <h2>Self.reload()</h2>
              <p>Load 1 bullet (required to fire weapon).</p>
              <h2>Self.heal()</h2>
              <p>Heal yourself for 1 HP (while bullets do 2 points of damage), but if you get hit while healing you suffer double damage.</p>
              <h2>Self.shield()</h2>
              <p>Use your shield (makes you immune for one round). Note that you have limited amount of shields to use.</p>
              <h2>Self.get_ammo()</h2>
              <p>Return how many loaded bullets you currently have.</p>
              <h2>Self.get_max_ammo()</h2>
              <p>Return the maximum amount of bullets you can load.</p>
              <h2>Self.get_hp()</h2>
              <p>Return how much HP (health points) you currently have.</p>
              <h2>Self.get_max_hp()</h2>
              <p>Return how much HP you have when your health is full.</p>
              <h2>Self.get_shields_left()</h2>
              <p>Return how many shields you got left to use.</p>
              <h2>Self.get_max_shields()</h2>
              <p>Return how many shields you can have in total (how many you start with).</p>

              <hr />
              <h1>Enemy</h1>
              <p>Provide data about your enemy bot.<br /><br />
                  'Enemy' module got the exact same API as 'Self', but without the functions to perform actions (eg without 'fire()', 'reload()', 'heal()' and 'shield()').
              </p>

          </div>
          <div class="modal-footer">
            <button type="button" data-dismiss="modal" class="btn btn-lg btn-primary">Done</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->


    <!-- main menu -->
    <div id="main-menu" style="position:fixed; width:100%; top:18%; height:200px; text-align:center;">
        <h1 style="color:white; font-size: 6em;">Bot Wars</h1>
        <button type="button" onclick="open_new_game_menu();" class="btn menu btn-lg btn-danger">Play!</button><br />
        <button type="button" onclick="show_instructions();" class="btn menu btn-lg btn-warning">Instructions</button><br />
        <a href="http://www.adderscript.com" target="_blank"><button type="button" class="btn menu btn-lg btn-info">About Adder</button></a><br />
        <button type="button" onclick="show_credits();" class="btn menu btn-lg btn-success">Credits</button><br />
        <h3 style="color:white">Powered by <a href="http://www.adderscript.com" target="_blank">AdderScript</a>.</h3>
    </div>

    <!-- end-game menu -->
    <div id="end-game-menu" style="position:fixed; width:100%; top:18%; height:200px; text-align:center; display: none">
        <h1 id="fight-result" style="color:white; font-size: 6em;">Bot Wars</h1>
        <p id="fight-end-reason" style="color:white; font-size: 3em;"></p>
        <button type="button" onclick="$('#end-game-menu').hide(); $('#main-menu').show();" class="btn menu btn-lg btn-danger">Back</button><br />
    </div>

    <!-- stop fight button -->
    <button id="stop-fight-button" type="button" style="position:fixed; left:6px; bottom:6px; display:none;" onclick="game_data.was_stopped = true; show_end_of_fight_screen();" class="btn menu btn-lg btn-danger">Stop Fight</button><br />

    <!-- init code mirror -->
    <script type="text/javascript">
        var editor = CodeMirror.fromTextArea(document.getElementById('code'), {
            parserfile: ["libs/python.js"],
            stylesheet: "libs/pythoncolors.css",
            path: "libs/",
            lineNumbers: true,
            textWrapping: false,
            indentUnit: 4,
            parserConfig: {'pythonVersion': 2, 'strictErrors': true}
        });
        window.user_code = editor;

        $("#play-menu").hide();
    </script>

    <!-- init Adder environment -->
    <script src="js/init_adder.js"></script>
</body>
</html>